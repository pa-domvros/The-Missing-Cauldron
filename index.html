<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Charalampos's Adventures — The Missing Cauldron</title>
<style>
  :root{
    --bg:#1f1410; --ink:#f8f7f4; --gold:#ffe8b0; --panel:#140c08;
    --ok:#1f6f3d; --err:#7f1d1d; --line:#0008; --inkmut:#e9e5da;
  }
  html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family:system-ui,Segoe UI,Roboto,Inter,Arial}
  body.modal-open{overflow:hidden}

  /* ===== SPLASH (castle) ===== */
  #splash{
    position:fixed; inset:0; z-index:80; display:flex; flex-direction:column; background:#000;
  }
  #splash::before{
    content:""; position:absolute; inset:0; background:url("castle.jpg") center/cover no-repeat;
    filter:saturate(.95) contrast(1.05);
  }
  .splash-top{
    position:relative; z-index:1; display:flex; flex-direction:column; align-items:flex-start;
    gap:6px; padding:18px 20px;
  }
  /* ORIGINAL colour (gold), 15% smaller than earlier, single line */
  .splash-title{
    margin:0; color:var(--gold); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    font-size:clamp(19px,3.1vw,34px); /* 15% down from 22px/3.6vw/40px */
    text-shadow:0 2px 6px #000; /* same subtle glow as before */
  }
  /* Credit: plain black, one line, no bg/padding/blur */
  .splash-credit{
    margin:0; color:#000; white-space:nowrap; text-shadow:none; font-style:italic;
    font-size:clamp(14px,1.8vw,18px);
  }
  .splash-center{ position:relative; z-index:1; margin:auto; text-align:center; padding:20px; }
  /* ENTER: absolutely no background; white font only */
  .enter-btn{
    background:transparent; border:none; box-shadow:none; text-shadow:none; cursor:pointer;
    font-family:"Brush Script MT","Segoe Script","URW Chancery L",cursive;
    font-size:clamp(28px,5vw,48px); color:#fff; padding:0;
  }
  .enter-btn:hover{opacity:.92;}
  .enter-btn:focus{outline:0;} /* keep it visually clean as requested */

  /* ===== APP WRAP ===== */
  .wrap{min-height:100vh;display:flex;flex-direction:column}
  header{padding:16px 18px;background:#1a100c;border-bottom:1px solid #0007}
  header h1{margin:.2em 0;color:var(--gold);font-size:clamp(20px,2.4vw,28px)}
  header .credit{font-style:italic;opacity:.9;color:var(--inkmut)}
  header .top-actions{margin-top:8px; display:flex; gap:8px; flex-wrap:wrap}

  main{
    flex:1; display:grid;
    grid-template-columns: minmax(520px,560px) minmax(580px,1fr);
    gap:32px; padding:18px; align-items:start; box-sizing:border-box;
    max-width:1500px; margin:0 auto; width:100%;
  }
  @media (max-width:1200px){
    main{grid-template-columns:1fr}
    .board{order:-1}
  }
  .panel{background:var(--panel);border:1px solid var(--line);border-radius:14px;box-shadow:0 10px 24px #0008;padding:14px;position:relative}

  /* LEFT BOARD — blueprint with gentle dark filter so nodes pop */
  .board{
    position:relative;min-height:600px;overflow:hidden;width:100%;max-width:560px;margin:0 auto;
    background:url("blueprint.jpg") center/cover no-repeat;
  }
  .board::before{
    content:""; position:absolute; inset:0; z-index:0; background:rgba(10,8,6,.45);
  }
  .board::after{
    content:""; position:absolute; inset:0; z-index:0; box-shadow: inset 0 0 80px 18px rgba(0,0,0,.45); pointer-events:none;
  }
  .node{position:absolute;width:64px;height:64px;border-radius:50%;display:flex;align-items:center;justify-content:center;
        border:2px solid #d4af37;background:#0f0a07;color:var(--gold);font-weight:900;cursor:pointer;user-select:none; z-index:2}
  .node.locked{opacity:.5;cursor:not-allowed;filter:grayscale(.4)}
  .node.done{background:#102614;border-color:#2d7a45;color:#eaffee}
  .node.glow{box-shadow:0 0 0 10px rgba(212,175,55,.22),0 0 18px #d4af37}
  .me{position:absolute;left:0;top:0;width:44px;height:44px;border-radius:50%;border:2px solid #d4af37;background:#1f4d36; z-index:2}
  .legend{position:absolute;left:14px;bottom:14px;display:flex;gap:10px;flex-wrap:wrap; z-index:2}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #444;background:#0003;color:var(--inkmut)}

  /* RIGHT CONTENT */
  #content{min-height:600px; position:relative}
  h2{margin:.2em 0;color:var(--gold)}
  .runes{display:flex;gap:8px;margin:8px 0}
  .r{width:30px;height:30px;border-radius:6px;border:1px solid #d4af37;background:#0003;display:flex;align-items:center;justify-content:center;color:var(--gold);font-weight:900}
  .r.got{background:#132713;border-color:#2c7a45;color:#e7ffe9}
  .box{padding:12px;border:1px solid #0007;border-radius:12px;background:#0f0a07}
  .q{margin:10px 0;padding:12px;border:1px solid #0006;border-radius:10px;background:#100a07}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .btn{appearance:none;border:1px solid #b78c18;background:linear-gradient(180deg,#7a5a12,#3f2d0a);color:#ffe8a3;border-radius:10px;padding:10px 14px;cursor:pointer}
  .btn.ghost{border-color:#444;background:#0003;color:#fff}
  .pill.ok{background:#09361b;border-color:#12552b;color:#d7ffe0}
  .pill.err{background:#3b0d0d;border-color:#5a1111;color:#ffd7d7}
  select,button,input,textarea{font-size:17px}
  input[type="text"]{width:min(720px,100%);padding:10px;border-radius:8px;border:1px solid #333;background:#0b0806;color:var(--ink)}
  textarea{width:100%;min-height:140px;padding:12px;border-radius:10px;border:1px solid #333;background:#0b0806;color:var(--ink);resize:vertical}
  .divider{height:1px;background:#0008;margin:14px 0}
  footer{padding:10px 14px;text-align:center;background:#120b08;border-top:1px solid #000;color:#cbbfa9}
  .choices{display:flex;gap:16px;flex-wrap:wrap;margin-top:8px}
  label.choice{display:flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid #444;border-radius:10px;background:#0003;cursor:pointer}

  /* ======= Modals ======= */
  #modalBackdrop{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:50}
  .modal{display:none;position:fixed;inset:0;z-index:51;align-items:center;justify-content:center}
  .modal-card{width:min(900px,94vw);max-height:90vh;overflow:auto;background:#140c08;border:1px solid #000;
              box-shadow:0 20px 40px #000;border-radius:14px;padding:16px}
  .modal-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;gap:8px;flex-wrap:wrap}
  .modal-title{margin:0;color:var(--gold);font-size:1.2rem}
  .two-col{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:800px){
    .two-col{grid-template-columns:1fr}
    .modal-card{padding:14px}
  }

  /* Characters gallery */
  .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px}
  .thumb{position:relative;border-radius:12px;overflow:hidden;border:1px solid #222;background:#0b0806}
  .thumb img{width:100%;aspect-ratio:3/4;object-fit:cover;display:block}
  .thumb .cap{position:absolute;inset:auto 0 0 0;background:linear-gradient(180deg,transparent,rgba(0,0,0,.75));
              color:#fff;padding:8px 10px;font-size:.9rem}
  .thumb button{position:absolute;inset:0;opacity:0}
  .gallery-note{color:#cbbfa9;font-size:.95rem;margin-top:6px}

  /* Lightbox viewer */
  #viewer{display:none;position:fixed;inset:0;background:rgba(0,0,0,.92);z-index:60;align-items:center;justify-content:center}
  #viewerInner{max-width:min(1100px,92vw);max-height:92vh;display:flex;flex-direction:column;gap:10px}
  #viewerImg{max-width:100%;max-height:82vh;object-fit:contain;border-radius:12px}
  #viewerCap{color:#fff;text-align:center}
  .viewer-actions{position:fixed;inset:0;pointer-events:none}
  .viewer-btn{pointer-events:auto;position:absolute;top:50%;transform:translateY(-50%);
              background:#0008;border:1px solid #555;color:#fff;border-radius:12px;padding:10px 14px;cursor:pointer}
  .viewer-btn.prev{left:12px}
  .viewer-btn.next{right:12px}
  .viewer-btn.close{top:12px;right:12px;transform:none}

  /* Decorative cat — much higher and ~20% smaller (from 160px -> 128px) */
  .cat-note{
    position:absolute; right:-6px; top:-120px; width:min(128px,18%); aspect-ratio:4/3;
    background:url("cat.jpg") center/cover no-repeat;
    border-radius:10px; border:2px solid #3a2a1a;
    box-shadow:
      inset 0 0 35px 12px rgba(0,0,0,.55),
      inset 0 0 8px 2px rgba(255,140,0,.15),
      0 10px 24px rgba(0,0,0,.5);
    filter: sepia(.18) contrast(1.05);
    outline:2px dashed rgba(0,0,0,.25);
    outline-offset:-8px;
    pointer-events:none;
  }
  @media (max-width:800px){
    .cat-note{width:112px; right:-4px; top:-100px;}
  }
</style>
</head>
<body>

<!-- ===== Splash (Castle) ===== -->
<section id="splash" aria-label="Intro screen with castle">
  <div class="splash-top">
    <h1 class="splash-title">Charalampos's Adventures — The Missing Cauldron</h1>
    <p class="splash-credit">Created: Panagiotis Domvros, English and Drama Educator, All Rights Reserved</p>
  </div>
  <div class="splash-center">
    <button class="enter-btn" id="enterBtn" type="button" aria-label="Enter the academy">Enter</button>
  </div>
</section>

<!-- ===== App ===== -->
<div id="app" class="wrap" style="display:none">
  <header>
    <h1>Charalampos's Adventures — The Missing Cauldron</h1>
    <div class="credit">Created: Panagiotis Domvros, English and Drama Educator,  All Rights Reserved</div>
    <div class="top-actions">
      <button class="btn" type="button" id="openStory">Story Intro</button>
      <button class="btn ghost" type="button" id="openCodex">Codex & Glossary</button>
      <button class="btn ghost" type="button" id="openCharacters">Characters</button>
    </div>
  </header>

  <main>
    <!-- LEFT: BOARD -->
    <section class="panel board" id="board" aria-label="Quest Board">
      <div id="me" class="me" title="Charalampos"></div>
      <div class="node" id="n1" style="left:22px;top:24px" role="button" tabindex="0" aria-label="Node 1">1</div>
      <div class="node locked" id="n2" style="left:150px;top:140px" role="button" tabindex="0" aria-label="Node 2">2</div>
      <div class="node locked" id="n3" style="left:50px;top:280px" role="button" tabindex="0" aria-label="Node 3">3</div>
      <div class="node locked" id="n4" style="left:220px;top:340px" role="button" tabindex="0" aria-label="Node 4">4</div>
      <div class="node locked" id="n5" style="left:360px;top:230px" role="button" tabindex="0" aria-label="Node 5">5</div>
      <div class="node locked" id="n6" style="left:440px;top:360px" role="button" tabindex="0" aria-label="Node 6">6</div>
      <div class="node locked" id="n7" style="left:440px;top:120px" role="button" tabindex="0" aria-label="Finale">🏆</div>

      <div class="legend" aria-hidden="true">
        <span class="pill">Click <b>1</b> to start</span>
        <span class="pill">Green = done</span>
        <span class="pill">🏆 = Cauldron Room</span>
      </div>
    </section>

    <!-- RIGHT: TASKS (cat high and smaller) -->
    <section class="panel" id="content">
      <div class="cat-note" aria-hidden="true"></div>

      <div id="intro">
        <h2>Welcome to the Academy of Lithourgia!</h2>
        <p>This is one of many <b>Charalampos's Adventures</b>. In this episode, the <b>Grand Feast Cauldron</b> has gone missing. Solve each node to gather evidence and file a proper complaint to recover it.</p>
        <div class="runes"><div class="r" id="r1">_</div><div class="r" id="r2">_</div><div class="r" id="r3">_</div><div class="r" id="r4">_</div></div>
        <p><button class="btn" id="startQuest" type="button">Start Quest</button></p>
        <div class="divider"></div>
        <div class="box"><b>Tip:</b> Click a board number to open its task. Open <i>Story Intro</i> any time for a refresher.</div>
      </div>

      <!-- TASK 1 -->
      <div id="t1" style="display:none">
        <h2>Task 1 — Complaint Vocabulary</h2>
        <p>Choose the correct word for each definition.</p>
        <div class="q">money returned to a customer —
          <select id="v1"><option value="">—</option><option value="receipt">receipt</option><option value="refund">refund</option><option value="apology">apology</option></select>
        </div>
        <div class="q">a new product given instead of a faulty one —
          <select id="v2"><option value="">—</option><option value="guarantee">guarantee</option><option value="replacement">replacement</option><option value="discount">discount</option></select>
        </div>
        <div class="q">not working correctly —
          <select id="v3"><option value="">—</option><option value="late">late</option><option value="faulty">faulty</option><option value="damaged">damaged</option></select>
        </div>
        <div class="q">evidence that you bought the item —
          <select id="v4"><option value="">—</option><option value="warranty">warranty</option><option value="proof of purchase">proof of purchase</option><option value="apology">apology</option></select>
        </div>
        <div class="q">arrives later than expected —
          <select id="v5"><option value="">—</option><option value="damage">damage</option><option value="delay">delay</option><option value="complaint">complaint</option></select>
        </div>
        <div class="q">a promise to repair/replace within a time —
          <select id="v6"><option value="">—</option><option value="exchange">exchange</option><option value="warranty">warranty</option><option value="receipt">receipt</option></select>
        </div>
        <div class="q">physically harmed or broken —
          <select id="v7"><option value="">—</option><option value="scratched">scratched</option><option value="damaged">damaged</option><option value="faulty">faulty</option></select>
        </div>
        <div class="q">a statement that you are sorry —
          <select id="v8"><option value="">—</option><option value="reply">reply</option><option value="apology">apology</option><option value="refund">refund</option></select>
        </div>
        <div class="row"><button class="btn" id="check1">Check</button><span id="msg1" class="pill" aria-live="polite"></span></div>
      </div>

      <!-- TASK 2 -->
      <div id="t2" style="display:none">
        <h2>Task 2 — Modals in Complaints</h2>
        <div class="q">___ you please check my order?
          <select id="m1"><option value="">—</option><option value="Should">Should</option><option value="Could">Could</option><option value="Might">Might</option></select>
        </div>
        <div class="q">I ___ like to request a refund.
          <select id="m2"><option value="">—</option><option value="will">will</option><option value="would">would</option><option value="can">can</option></select>
        </div>
        <div class="q">You ___ deliver within two days.
          <select id="m3"><option value="">—</option><option value="may">may</option><option value="should">should</option><option value="might">might</option></select>
        </div>
        <div class="q">___ I speak to the manager, please?
          <select id="m4"><option value="">—</option><option value="Must">Must</option><option value="May">May</option><option value="Should">Should</option></select>
        </div>
        <div class="q">I ___ not accept a scratched wand.
          <select id="m5"><option value="">—</option><option value="can">can</option><option value="will">will</option><option value="may">may</option></select>
        </div>
        <div class="q">You ___ replace the item under the warranty.
          <select id="m6"><option value="">—</option><option value="could">could</option><option value="should">should</option><option value="would">would</option></select>
        </div>
        <div class="q">I ___ like an apology.
          <select id="m7"><option value="">—</option><option value="must">must</option><option value="would">would</option><option value="should">should</option></select>
        </div>
        <div class="q">The seller ___ respond within 48 hours.
          <select id="m8"><option value="">—</option><option value="might">might</option><option value="should">should</option><option value="may">may</option></select>
        </div>
        <div class="row"><button class="btn" id="check2">Check</button><span id="msg2" class="pill" aria-live="polite"></span></div>
      </div>

      <!-- TASK 3 -->
      <div id="t3" style="display:none">
        <h2>Task 3 — Passive Voice</h2>
        <div class="q">They delivered the wand yesterday. →
          <select id="p1"><option value="">—</option><option value="bad">The wand delivered yesterday.</option><option value="ok1">The wand was delivered yesterday.</option></select>
        </div>
        <div class="q">The courier damaged the box. →
          <select id="p2"><option value="">—</option><option value="bad">The box damaged by the courier.</option><option value="ok2">The box was damaged by the courier.</option></select>
        </div>
        <div class="q">They will replace the item. →
          <select id="p3"><option value="">—</option><option value="bad">The item will replaced.</option><option value="ok3">The item will be replaced.</option></select>
        </div>
        <div class="q">They have sent a refund. →
          <select id="p4"><option value="">—</option><option value="bad">A refund is send.</option><option value="ok4">A refund has been sent.</option></select>
        </div>
        <div class="q">They must answer the complaint. →
          <select id="p5"><option value="">—</option><option value="bad">The complaint must answered.</option><option value="ok5">The complaint must be answered.</option></select>
        </div>
        <div class="row"><button class="btn" id="check3">Check</button><span id="msg3" class="pill" aria-live="polite"></span></div>
      </div>

      <!-- TASK 4 -->
      <div id="t4" style="display:none">
        <h2>Task 4 — Reading: Angry Review</h2>
        <div class="box">
          <p><b>"Night Market Wands – One Star"</b></p>
          <p>I bought a "Phoenix-grade wand" yesterday. It arrived late, the box was broken, and the wand was scratched.
          The seller promised fast delivery, but nobody answered my owl. I want a refund or a working replacement.</p>
        </div>

        <div class="q">
          <div>1) What was wrong with the packaging?</div>
          <div class="choices">
            <label class="choice"><input type="radio" name="r1" value="broken"> It was broken.</label>
            <label class="choice"><input type="radio" name="r1" value="fine"> It was fine.</label>
          </div>
        </div>

        <div class="q">
          <div>2) What solution does the reviewer want?</div>
          <div class="choices">
            <label class="choice"><input type="radio" name="r2" value="coupon"> A discount coupon.</label>
            <label class="choice"><input type="radio" name="r2" value="refund_or_replacement"> A refund or a replacement.</label>
          </div>
        </div>

        <div class="q">
          <div>3) Did support reply?</div>
          <div class="choices">
            <label class="choice"><input type="radio" name="r3" value="no"> No.</label>
            <label class="choice"><input type="radio" name="r3" value="yes"> Yes.</label>
          </div>
        </div>

        <div class="row"><button class="btn" id="check4">Check</button><span id="msg4" class="pill" aria-live="polite"></span></div>
      </div>

      <!-- TASK 5 -->
      <div id="t5" style="display:none">
        <h2>Task 5 — Formal vs Informal</h2>
        <div class="q">I would like to request a refund.
          <label><input type="radio" name="f1" value="I"> Informal</label>
          <label><input type="radio" name="f1" value="F"> Formal</label>
        </div>
        <div class="q">Hey, this is bad. Fix it!
          <label><input type="radio" name="f2" value="I"> Informal</label>
          <label><input type="radio" name="f2" value="F"> Formal</label>
        </div>
        <div class="q">Could you replace the item under the warranty?
          <label><input type="radio" name="f3" value="I"> Informal</label>
          <label><input type="radio" name="f3" value="F"> Formal</label>
        </div>
        <div class="q">You guys messed up.
          <label><input type="radio" name="f4" value="I"> Informal</label>
          <label><input type="radio" name="f4" value="F"> Formal</label>
        </div>
        <div class="row"><button class="btn" id="check5">Check</button><span id="msg5" class="pill" aria-live="polite"></span></div>
      </div>

      <!-- TASK 6 -->
      <div id="t6" style="display:none">
        <h2>Task 6 — Write a Short Complaint</h2>
        <p>Write 1–3 sentences. Include: opening, reason, one passive, polite request, closing + name.</p>
        <div class="q">Your text:
          <textarea id="w3" placeholder="Dear Sir or Madam, I am writing to complain about the cauldron. The box was damaged. I would like a replacement. Yours faithfully, Charalampos Keramefs"></textarea>
        </div>
        <div class="row"><button class="btn" id="check6">Check & Submit</button><span id="msg6" class="pill" aria-live="polite"></span></div>
        <div id="preview" class="box" style="display:none;margin-top:10px"><pre id="pv" style="white-space:pre-wrap"></pre></div>
      </div>

      <!-- FINALE -->
      <div id="finale" style="display:none">
        <h2>Cauldron Room Unlocked!</h2>
        <p>Victory! The merchant guild approves a replacement cauldron. The Feast is saved — and <b>Charalampos’s</b> reputation grows. Next time: <b>Charalampos's Adventures — The Whispering Grimoire</b>.</p>
        <div class="runes"><div class="r got">C</div><div class="r got">A</div><div class="r got">S</div><div class="r got">T</div></div>
        <div class="row"><button class="btn" id="replay">Play again</button></div>
      </div>
    </section>
  </main>

  <footer>✨✍️ Devised by Panagiotis Domvros, English and Drama Teacher, All Rights Reserved ✍️✨</footer>
</div>

<!-- ======= Backdrop ======= -->
<div id="modalBackdrop" aria-hidden="true"></div>

<!-- Story Intro Modal -->
<div id="storyModal" class="modal" aria-modal="true" role="dialog" aria-labelledby="storyTitle" aria-hidden="true">
  <div class="modal-card">
    <div class="modal-head">
      <h2 id="storyTitle" class="modal-title">Story Intro — The Missing Cauldron</h2>
      <button class="btn ghost" id="closeStory" type="button">Close</button>
    </div>
    <div id="storyPages">
      <div class="storyPage">
        <h3>1) Setup</h3>
        <p>Welcome to the <b>Academy of Lithourgia</b>, where language and magic meet. The <b>Grand Feast Cauldron</b> has disappeared. Without it, the Feast fails!</p>
        <p><b>Charalampos Keramefs</b> (you) must investigate by reading reviews, choosing polite language, and writing a proper complaint if needed.</p>
      </div>
      <div class="storyPage" style="display:none">
        <h3>2) Characters</h3>
        <ul>
          <li><b>Charalampos Keramefs</b> — our polite but determined hero.</li>
          <li><b>Headmaster Glyfadoros</b> — wise; expects clear evidence.</li>
          <li><b>Myrto Lykandri</b> — friend; passive voice expert.</li>
          <li><b>Drakon Malveris</b> — rival; rude language, bad examples.</li>
          <li><b>Master Koprianos</b> — shopkeeper; may have sold a faulty cauldron.</li>
        </ul>
      </div>
      <div class="storyPage" style="display:none">
        <h3>3) The Mystery</h3>
        <p>The last cauldron was purchased from <b>Night Market Wands & Ware</b>. Delivery was late, the box was damaged, and support was silent. Collect evidence to compel a replacement.</p>
      </div>
      <div class="storyPage" style="display:none">
        <h3>4) How to Play</h3>
        <ol>
          <li><b>Vocabulary</b> (refund, warranty…)</li>
          <li><b>Modals</b> (Could/May/Should…)</li>
          <li><b>Passive voice</b> (was delivered, was damaged…)</li>
          <li><b>Reading</b> evidence</li>
          <li><b>Register</b> (formal vs informal)</li>
          <li><b>Write</b> the complaint</li>
        </ol>
      </div>
    </div>
    <div style="display:flex;justify-content:space-between;margin-top:10px;align-items:center;gap:8px">
      <button class="btn ghost" id="prevStory" type="button">◀ Prev</button>
      <div class="pill" id="storyStep" aria-live="polite">1 / 4</div>
      <button class="btn" id="nextStory" type="button">Next ▶</button>
    </div>
  </div>
</div>

<!-- Codex & Glossary Modal -->
<div id="codexModal" class="modal" aria-modal="true" role="dialog" aria-labelledby="codexTitle" aria-hidden="true">
  <div class="modal-card">
    <div class="modal-head">
      <h2 id="codexTitle" class="modal-title">Codex & Glossary</h2>
      <button class="btn ghost" id="closeCodex" type="button">Close</button>
    </div>
    <div class="two-col">
      <div class="box">
        <h3>Complaint Glossary</h3>
        <ul style="columns:2;column-gap:16px">
          <li><b>refund</b> — money returned</li>
          <li><b>replacement</b> — new item instead</li>
          <li><b>faulty</b> — not working</li>
          <li><b>damaged</b> — physically harmed</li>
          <li><b>warranty</b> — promise to repair/replace</li>
          <li><b>proof of purchase</b> — receipt/evidence</li>
          <li><b>delay</b> — arriving late</li>
          <li><b>apology</b> — statement of regret</li>
        </ul>
      </div>
      <div class="box">
        <h3>Polite Language</h3>
        <ul>
          <li><b>Could you</b> / <b>May I</b> …?</li>
          <li><b>I would like</b> to request…</li>
          <li><b>Yours faithfully,</b> (formal closing)</li>
        </ul>
        <p class="gallery-note">Characters and places have moved to the <b>Characters</b> tab.</p>
      </div>
    </div>
  </div>
</div>

<!-- Characters Modal (image gallery) -->
<div id="charactersModal" class="modal" aria-modal="true" role="dialog" aria-labelledby="charactersTitle" aria-hidden="true">
  <div class="modal-card" style="width:min(1000px,95vw)">
    <div class="modal-head">
      <h2 id="charactersTitle" class="modal-title">Characters & Places</h2>
      <button class="btn ghost" id="closeCharacters" type="button">Close</button>
    </div>
    <div class="gallery" id="gallery">
      <figure class="thumb" data-src="Academy of Lithourgia.jpg" data-cap="Academy of Lithourgia — Campus">
        <img src="Academy of Lithourgia.jpg" alt="Academy of Lithourgia" loading="lazy">
        <figcaption class="cap">Academy of Lithourgia</figcaption><button aria-label="View Academy of Lithourgia"></button>
      </figure>
      <figure class="thumb" data-src="Charalampos Keramefs.jpg" data-cap="Charalampos Keramefs — The Hero">
        <img src="Charalampos Keramefs.jpg" alt="Charalampos Keramefs" loading="lazy">
        <figcaption class="cap">Charalampos Keramefs</figcaption><button aria-label="View Charalampos Keramefs"></button>
      </figure>
      <figure class="thumb" data-src="Drakon Malveris.jpg" data-cap="Drakon Malveris — Rival">
        <img src="Drakon Malveris.jpg" alt="Drakon Malveris" loading="lazy">
        <figcaption class="cap">Drakon Malveris</figcaption><button aria-label="View Drakon Malveris"></button>
      </figure>
      <figure class="thumb" data-src="Great Hall.jpg" data-cap="Great Hall — Feast">
        <img src="Great Hall.jpg" alt="Great Hall" loading="lazy">
        <figcaption class="cap">Great Hall</figcaption><button aria-label="View Great Hall"></button>
      </figure>
      <figure class="thumb" data-src="Headmaster Glyfadoros.jpg" data-cap="Headmaster Glyfadoros">
        <img src="Headmaster Glyfadoros.jpg" alt="Headmaster Glyfadoros" loading="lazy">
        <figcaption class="cap">Headmaster Glyfadoros</figcaption><button aria-label="View Headmaster Glyfadoros"></button>
      </figure>
      <figure class="thumb" data-src="Master Koprianos.jpg" data-cap="Master Koprianos — Merchant">
        <img src="Master Koprianos.jpg" alt="Master Koprianos" loading="lazy">
        <figcaption class="cap">Master Koprianos</figcaption><button aria-label="View Master Koprianos"></button>
      </figure>
      <figure class="thumb" data-src="Myrto Lykandri.jpg" data-cap="Myrto Lykandri — Grammar Expert">
        <img src="Myrto Lykandri.jpg" alt="Myrto Lykandri" loading="lazy">
        <figcaption class="cap">Myrto Lykandri</figcaption><button aria-label="View Myrto Lykandri"></button>
      </figure>
      <figure class="thumb" data-src="Night Market.jpg" data-cap="Night Market — Bazaar">
        <img src="Night Market.jpg" alt="Night Market" loading="lazy">
        <figcaption class="cap">Night Market</figcaption><button aria-label="View Night Market"></button>
      </figure>
    </div>
    <p class="gallery-note">Click any card to enlarge. Use ◀ ▶ or swipe to navigate; press Esc to close.</p>
  </div>
</div>

<!-- Lightbox viewer -->
<div id="viewer" role="dialog" aria-modal="true" aria-label="Image viewer">
  <div id="viewerInner">
    <img id="viewerImg" alt="">
    <div id="viewerCap"></div>
  </div>
  <div class="viewer-actions">
    <button class="viewer-btn prev" id="viewerPrev" aria-label="Previous">◀</button>
    <button class="viewer-btn next" id="viewerNext" aria-label="Next">▶</button>
    <button class="viewer-btn close" id="viewerClose" aria-label="Close">✕</button>
  </div>
</div>

<!-- Lore / Interlude Modal -->
<div id="loreModal" class="modal" aria-modal="true" role="dialog" aria-labelledby="loreTitle" aria-hidden="true">
  <div class="modal-card" style="width:min(760px,92vw)">
    <div class="modal-head">
      <h2 id="loreTitle" class="modal-title">Scene</h2>
      <button class="btn ghost" id="closeLore" type="button">Continue</button>
    </div>
    <div id="loreText" class="box" style="font-size:1.05rem;line-height:1.5"></div>
  </div>
</div>

<script>
/* ===== Splash control ===== */
document.getElementById('enterBtn').addEventListener('click', ()=>{
  const splash = document.getElementById('splash');
  splash.style.opacity = '0';
  splash.style.pointerEvents = 'none';
  setTimeout(()=>{ splash.style.display='none'; }, 150);
  document.getElementById('app').style.display='flex';
});

/* ===== Helpers ===== */
const $=s=>document.querySelector(s);
function show(id){['intro','t1','t2','t3','t4','t5','t6','finale'].forEach(x=>$('#'+x).style.display='none'); $('#'+id).style.display='block';}
function tokenTo(nodeId){ const n=$('#'+nodeId), me=$('#me'); me.style.left=n.style.left; me.style.top=n.style.top; }
function lock(id,yes){ $('#'+id).classList.toggle('locked', !!yes); }
function done(id){ $('#'+id).classList.add('done'); }
function giveRune(i,letter){ const el=$('#r'+i); el.textContent=letter; el.classList.add('got'); }

/* ===== Start state ===== */
tokenTo('n1'); $('#n1').classList.add('glow'); show('intro');

/* ===== Board clicks ===== */
['n1','n2','n3','n4','n5','n6','n7'].forEach(id=>{
  const el = $('#'+id);
  el.addEventListener('click',()=>{
    if(el.classList.contains('locked')) return;
    const tid = id==='n7' ? 'finale' : 't'+id.slice(1);
    if(id==='n1') $('#n1').classList.remove('glow');
    show(tid);
  });
  el.addEventListener('keydown',e=>{
    if((e.key==='Enter'||e.key===' ') && !el.classList.contains('locked')){
      e.preventDefault(); el.click();
    }
  });
});

$('#startQuest').onclick=()=>{ $('#n1').classList.remove('glow'); show('t1'); };

/* ===== Modal utilities ===== */
const backdrop = $('#modalBackdrop');
const storyModal = $('#storyModal');
const codexModal = $('#codexModal');
const charactersModal = $('#charactersModal');
const loreModal = $('#loreModal');
function openModal(el){ backdrop.style.display='block'; el.style.display='flex'; el.setAttribute('aria-hidden','false'); document.body.classList.add('modal-open'); }
function closeModal(el){
  el.style.display='none'; el.setAttribute('aria-hidden','true');
  const anyOpen = [storyModal,codexModal,charactersModal,loreModal].some(m=>m.style.display==='flex');
  if(!anyOpen) { backdrop.style.display='none'; document.body.classList.remove('modal-open'); }
}

/* Buttons to open/close modals */
$('#openStory').addEventListener('click',()=>openModal(storyModal));
$('#closeStory').addEventListener('click',()=>closeModal(storyModal));
$('#openCodex').addEventListener('click',()=>openModal(codexModal));
$('#closeCodex').addEventListener('click',()=>closeModal(codexModal));
$('#openCharacters').addEventListener('click',()=>openModal(charactersModal));
$('#closeCharacters').addEventListener('click',()=>closeModal(charactersModal));
$('#closeLore').addEventListener('click',()=>closeModal(loreModal));

/* Backdrop click closes whichever modal is open */
backdrop.addEventListener('click',()=>[storyModal,codexModal,charactersModal,loreModal].forEach(m=>{ if(m.style.display==='flex') closeModal(m); }));

/* ESC key to close topmost open modal or viewer */
document.addEventListener('keydown',(e)=>{
  if(e.key==='Escape'){
    if($('#viewer').style.display==='flex'){ closeViewer(); return; }
    const openInOrder=[loreModal,charactersModal,codexModal,storyModal];
    const top=openInOrder.find(m=>m.style.display==='flex'); if(top) closeModal(top);
  }
});

/* Story paging */
const pages = Array.from(document.querySelectorAll('#storyPages .storyPage'));
let pageIndex = 0;
function showStoryPage(i){ pageIndex=Math.max(0,Math.min(i,pages.length-1)); pages.forEach((p,idx)=>p.style.display=(idx===pageIndex?'block':'none')); $('#storyStep').textContent=(pageIndex+1)+' / '+pages.length; }
$('#nextStory').addEventListener('click',()=>showStoryPage(pageIndex+1));
$('#prevStory').addEventListener('click',()=>showStoryPage(pageIndex-1));
showStoryPage(0);

/* Interludes */
const loreText = $('#loreText');
const loreByStage = {
  1: `Vocabulary unlocked. Myrto whispers: “Words open doors. Next, ask politely — even Malveris listens to manners.”`,
  2: `Your polite requests echo. A portrait hints: “Was it delivered… or merely claimed so?”`,
  3: `Passive traces glow on the wall: “The box was damaged.” Evidence grows.`,
  4: `The angry review aligns with your notes. Glyfadoros nods: “Facts first, then tone.”`,
  5: `Formal style chosen. The guild seal warms in your palm — the complaint can be filed.`,
  6: `Your complaint is ready. A courier owl takes flight. Locks click open in the Cauldron Room.`
};
function showInterlude(stageNum){ loreText.textContent=loreByStage[stageNum]||'You advance through the halls of the Academy.'; openModal(loreModal); }

/* ===== TASK CHECKERS ===== */
$('#check1').onclick=()=>{
  const ok = ($('#v1').value==='refund') && ($('#v2').value==='replacement') && ($('#v3').value==='faulty') &&
             ($('#v4').value==='proof of purchase') && ($('#v5').value==='delay') && ($('#v6').value==='warranty') &&
             ($('#v7').value==='damaged') && ($('#v8').value==='apology');
  const msg=$('#msg1');
  if(ok){ msg.textContent='✓ Correct. Rune: C'; msg.className='pill ok'; done('n1'); lock('n2',false); giveRune(1,'C'); tokenTo('n2'); showInterlude(1); }
  else { msg.textContent='✗ Some answers are incorrect.'; msg.className='pill err'; }
};

$('#check2').onclick=()=>{
  const ok = ($('#m1').value==='Could')&&($('#m2').value==='would')&&($('#m3').value==='should')&&($('#m4').value==='May')&&($('#m5').value==='will')&&($('#m6').value==='should')&&($('#m7').value==='would')&&($('#m8').value==='should');
  const msg=$('#msg2');
  if(ok){ msg.textContent='✓ Well done. Rune: A'; msg.className='pill ok'; done('n2'); lock('n3',false); giveRune(2,'A'); tokenTo('n3'); showInterlude(2); }
  else { msg.textContent='✗ Recheck modal meanings.'; msg.className='pill err'; }
};

$('#check3').onclick=()=>{
  const ok = ($('#p1').value==='ok1') && ($('#p2').value==='ok2') && ($('#p3').value==='ok3') && ($('#p4').value==='ok4') && ($('#p5').value==='ok5');
  const msg=$('#msg3');
  if(ok){ msg.textContent='✓ Great. Rune: S'; msg.className='pill ok'; done('n3'); lock('n4',false); giveRune(3,'S'); tokenTo('n4'); showInterlude(3); }
  else { msg.textContent='✗ Remember: be + past participle.'; msg.className='pill err'; }
};

function rv(name){ const x=document.querySelector('input[name="'+name+'"]:checked'); return x?x.value:''; }
$('#check4').onclick=()=>{
  const a1=rv('r1'), a2=rv('r2'), a3=rv('r3');
  const ok = (a1==='broken') && (a2==='refund_or_replacement') && (a3==='no');
  const msg=$('#msg4');
  if(ok){ msg.textContent='✓ Excellent. Rune: T'; msg.className='pill ok'; done('n4'); lock('n5',false); giveRune(4,'T'); tokenTo('n5'); showInterlude(4); }
  else{
    let wrong=[]; if(a1!=='broken') wrong.push('Q1'); if(a2!=='refund_or_replacement') wrong.push('Q2'); if(a3!=='no') wrong.push('Q3');
    msg.textContent='✗ Check: '+wrong.join(', '); msg.className='pill err';
  }
};

$('#check5').onclick=()=>{
  const val=name=>{const x=document.querySelector('input[name="'+name+'"]:checked'); return x?x.value:'';};
  const ok = (val('f1')==='F') && (val('f2')==='I') && (val('f3')==='F') && (val('f4')==='I');
  const msg=$('#msg5');
  if(ok){ msg.textContent='✓ Correct classification.'; msg.className='pill ok'; done('n5'); lock('n6',false); tokenTo('n6'); showInterlude(5); }
  else { msg.textContent='✗ Formal = polite/indirect/no slang.'; msg.className='pill err'; }
};

function hasPassive(s){ return /\b(was|were|is|are|been|be)\s+\w+(ed|en)\b/i.test(s); }
$('#check6').onclick = () => {
  const text = $('#w3').value.trim();
  const msg  = $('#msg6');
  const fb   = [];

  if (text.length < 30) fb.push('Make it a bit longer (≥ 30 characters).');
  const openingOK = /dear\s+(sir|madam|shopkeeper|customer\s*service|support)/i.test(text);
  if (!openingOK) fb.push('Add a polite opening (e.g., "Dear Sir or Madam,").');
  const reasonOK = /i\s+am\s+writing\s+to\s+complain\s+about|i\s+am\s+writing\s+regarding|i\s+received/i.test(text);
  if (!reasonOK) fb.push('Add a clear reason (e.g., "I am writing to complain about...").');
  const passiveOK = hasPassive(text);
  if (!passiveOK) fb.push('Use at least one passive (e.g., "The box was damaged.").');
  const requestOK = /(i\s+would\s+like|could\s+you|please\s+replace|i\s+request)/i.test(text);
  if (!requestOK) fb.push('Add a polite request (e.g., "I would like a refund.").');
  const closingOK = /(yours\s+faithfully|yours\s+sincerely|best|kind\s+regards)[,\.]?\s*\n?/i.test(text)
                    && /[A-Z][a-z]+/.test(text.split('\n').slice(-1)[0] || '');
  if (!closingOK) fb.push('Add a closing + your name (e.g., "Yours faithfully, Charalampos Keramefs").');

  if (fb.length){
    msg.textContent = '✗ Please add/correct: ' + fb.join(' | ');
    msg.className = 'pill err';
    $('#preview').style.display='none';
  } else {
    msg.textContent = '✓ Looks good! Structure complete.';
    msg.className = 'pill ok';
    $('#pv').textContent = text;
    $('#preview').style.display='block';
    done('n6'); lock('n7', false); tokenTo('n7'); showInterlude(6);
    setTimeout(()=>{ closeModal(loreModal); show('finale'); }, 1200);
  }
};

/* Replay */
$('#replay').onclick=()=>location.reload();

/* ===== Characters: lightbox viewer logic ===== */
const gallery = $('#gallery');
const viewer = $('#viewer');
const viewerImg = $('#viewerImg');
const viewerCap = $('#viewerCap');
const viewerPrev = $('#viewerPrev');
const viewerNext = $('#viewerNext');
const viewerClose = $('#viewerClose');
let items = [];
let idx = 0;

function collectItems(){
  items = Array.from(gallery.querySelectorAll('.thumb')).map(el=>({
    src: el.dataset.src,
    cap: el.dataset.cap || el.querySelector('.cap')?.textContent || ''
  }));
}
collectItems();

function openViewer(i){
  idx = Math.max(0, Math.min(i, items.length-1));
  const it = items[idx];
  viewerImg.src = it.src;
  viewerImg.alt = it.cap || 'Character image';
  viewerCap.textContent = it.cap;
  viewer.style.display = 'flex';
}
function closeViewer(){ viewer.style.display='none'; }
function next(){ openViewer((idx+1)%items.length); }
function prev(){ openViewer((idx-1+items.length)%items.length); }

gallery.addEventListener('click', (e)=>{
  const card = e.target.closest('.thumb'); if(!card) return;
  const i = Array.from(gallery.querySelectorAll('.thumb')).indexOf(card);
  openViewer(i);
});
viewerNext.addEventListener('click', next);
viewerPrev.addEventListener('click', prev);
viewerClose.addEventListener('click', closeViewer);
viewer.addEventListener('click', (e)=>{ if(e.target===viewer) closeViewer(); });
document.addEventListener('keydown',(e)=>{
  if(viewer.style.display==='flex'){
    if(e.key==='ArrowRight') next();
    else if(e.key==='ArrowLeft') prev();
  }
});
</script>
</body>
</html>
